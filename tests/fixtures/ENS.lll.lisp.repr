[[seq,
  [def, 'node-bytes, 0x00],
  [def, 'label-bytes, 0x20],
  [def, 'call-result, 0x40],
  [def, 'resolver, 0x00],
  [def, 'owner, 0x20],
  [def, 'ttl, 0x40],
  [def, 'get-node-owner, 0x02571be3],
  [def, 'get-node-resolver, 0x0178b8bf],
  [def, 'get-node-ttl, 0x16a25cbd],
  [def, 'set-node-owner, 0x5b0fc9c3],
  [def, 'set-subnode-owner, 0x06ab5923],
  [def, 'set-node-resolver, 0x1896f70a],
  [def, 'set-node-ttl, 0x14ab9038],
  [def, 'invalid-location, 0x02],
  [def, 'shift-right, [input], [div, input, [exp, 2, 224]]],
  [def,
   'function,
   [function-hash, code-body],
   [when, [=, [shift-right, [calldataload, 0x00]], function-hash], code-body]],
  [def,
   'get-record,
   [node, label],
   [seq,
    [mstore, node-bytes, node],
    [mstore, label-bytes, label],
    [sha3, node-bytes, 64]]],
  [def, 'get-owner, [node], [sload, [+, node, owner]]],
  [def, 'set-owner, [node, new-owner], [sstore, [+, node, owner], new-owner]],
  [def,
   'set-subowner,
   [node, label, new-owner],
   [sstore, [+, [get-record, node, label], owner], new-owner]],
  [def, 'get-resolver, [node], [sload, node]],
  [def, 'set-resolver, [node, new-resolver], [sstore, node, new-resolver]],
  [def, 'get-ttl, [node], [sload, [+, node, ttl]]],
  [def, 'set-ttl, [node, new-ttl], [sstore, [+, node, ttl], new-ttl]],
  [def,
   'only-node-owner,
   [node],
   [when, [!=, [caller], [get-owner, node]], [jump, invalid-location]]],
  [set-owner, 0x00, [caller]],
  [returnlll,
   [seq,
    [def, 'node, [calldataload, 0x04]],
    [function,
     get-node-resolver,
     [seq,
      [mstore, call-result, [get-resolver, node]],
      [return, call-result, 32]]],
    [def, 'node, [calldataload, 0x04]],
    [function,
     get-node-owner,
     [seq,
      [mstore, call-result, [get-owner, node]],
      [return, call-result, 32]]],
    [def, 'node, [calldataload, 0x04]],
    [function,
     get-node-ttl,
     [seq, [mstore, call-result, [get-ttl, node]], [return, call-result, 32]]],
    [def, 'node, [calldataload, 0x04]],
    [def, 'new-owner, [calldataload, 0x24]],
    [function,
     set-node-owner,
     [seq,
      [only-node-owner, node],
      [set-owner, node, new-owner],
      [mstore, call-result, new-owner],
      [log2,
       call-result,
       32,
       [sha3, 0x00, [lit, 0x00, 'Transfer(bytes32,address)']],
       node],
      [stop]]],
    [def, 'node, [calldataload, 0x04]],
    [def, 'label, [calldataload, 0x24]],
    [def, 'new-owner, [calldataload, 0x44]],
    [function,
     set-subnode-owner,
     [seq,
      [only-node-owner, node],
      [set-subowner, node, label, new-owner],
      [mstore, call-result, new-owner],
      [log3,
       call-result,
       32,
       [sha3, 0x00, [lit, 0x00, 'NewOwner(bytes32,bytes32,address)']],
       node,
       label],
      [stop]]],
    [def, 'node, [calldataload, 0x04]],
    [def, 'new-resolver, [calldataload, 0x24]],
    [function,
     set-node-resolver,
     [seq,
      [only-node-owner, node],
      [set-resolver, node, new-resolver],
      [mstore, call-result, new-resolver],
      [log2,
       call-result,
       32,
       [sha3, 0x00, [lit, 0x00, 'NewResolver(bytes32,address)']],
       node],
      [stop]]],
    [def, 'node, [calldataload, 0x04]],
    [def, 'new-ttl, [calldataload, 0x24]],
    [function,
     set-node-ttl,
     [seq,
      [only-node-owner, node],
      [set-ttl, node, new-ttl],
      [mstore, call-result, new-ttl],
      [log2,
       call-result,
       32,
       [sha3, 0x00, [lit, 0x00, 'NewTTL(bytes32,uint64)']],
       node],
      [stop]]],
    [jump, invalid-location]]]]]
